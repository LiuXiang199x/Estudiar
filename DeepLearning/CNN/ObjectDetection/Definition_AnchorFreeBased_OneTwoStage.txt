单阶段、双阶段、anchor-based、anchor-free这四者之间联系与区别

1. 单阶段和双阶段划分依据是是否存在显式的 roi 特征提取过程
    1.1 典型的双阶段算法是faster rcnn，其包括 RPN（或者k-means聚类等其他方法）和RCNN两个模块，RPN
    RPN（或者k-means聚类等其他方法） 模块负责提取 ROI，然后通过 roipool 或者 roialign 进行 roi 特征切割提取，
    最后在输入到 RCNN 中进行识别和定位。



    如果没有显式 roi 提取过程则认为是单阶段算法，例如典型的 yolo系列、retinanet 等等。
    一般而言，双阶段算法精度高但是速度慢一些，单阶段精度稍微低一点但是速度容易优化到比较快，但是随着算法的发展，
    两者的界限越来越模糊，两者结合的也有例如带 refine 阶段的 reppoints，可以认为是 1.5 阶段。


2. anchor-based、anchor-free 是从是否需要显式定义先验 anchor 角度区分
    2.1 如果需要定义 anchor 那么就是 anchor-base，
    目前主流算法大部分都是这个类型，例如 faster rcnn、retinanet 和 yolo 等等；
    
    2.2 anchor-free 是从 2019 年开始慢慢流行，其最大优势是不需要设置麻烦且有重大影响的 anchor，
    输出是对每个输出特征图上点进行分类和定位建模，参数稍微少一些，更加容易理解，
    典型算法是 fcos、atss 和 sabl 等等。

------------------------------------------------------------------------------------------------------------
四者的联系是Label的编码方式。也就是一张图中若干个Label，(x0, y0, x1, y1,c)的GT检测框，是如何变为一张(1,C,H,W)的Feature Map的

1. 先从Anchor Free方法讲起。这类方法通过一些自定义的，简单的映射关系，将一个检测框的坐标直接映射到Feature Map中，比如CenterNet大致的思路是： 
    1.1 求出GT框的中心，然后将这个中心编码成一个Heat Map对应坐标的一个点（一般这个点附近带有高斯分布） 
    1.2 将这个GT框的宽高编码成对应wh Map对应坐标的一个点 
    1.3 从而形成Heatmap + wh map，简单来说，然后检测器通过heatmap学习对目标的分类，wh map学习对目标宽高的回归（实际过程中会加上offset，但这里为了简化问题不做详细讨论，详见CenterNet论文）
    1.4 可以看到，在Anchor Free方法的Label编码过程中，始终是利用了目标本身的性质（图像坐标、属性），没有引入额外的信息 
    
2. Anchor Based方法是在Anchor Free的基础上，为目标的宽高引入了若干个先验值：
    2.1 对于Heatmap Label Feature Map中的一个点，只有当以这个点为中心，先验值的宽高所组成的“假设框"与真值很相近（比如IOU足够大），才会将检测框编码到这个点上。 
    2.2 对于wh Map中的一个点，则在编码的过程中加入anchor的宽高信息，例如faster RCNN在RPN中，对应的wh map值是GT框的宽高除以anchor宽高，再取对数
    
3. Two Stage方法大多使用Anchor Based这种Label 编码方式，并且将GT框的类别和坐标的编码分离。
以Faster RCNN为例，将GT框的坐标框单独编码，在RPN中做对其做回归+一个简单的正负样本的二分类；
而具体的类别则在RCNN部分对RPN中得到的bbox candidate进行分类（这里还有一个对检测框的修正，为了简化问题，不做赘述） 

4. One Stage方法和Two Stage方法的不同，本质是没有分离坐标和类别属性，可以理解为就是一个加入多类别属性分类的RPN。
显然，不管是One Stage还是Two Stage方法，可以用Anchor Based也可以用Anchor Free对坐标进行编码

不同的编码方式，决定了模型真正学习的目标（Label Feature Map）的样本数值分布，决定了任务的难易程度，也赋予了不同检测方式的“某种天赋“。
比如Anchor Based方法在不同大小的目标下具有更好的鲁棒性，Anchor Free计算量更少，等等。具体原因不在这个问题的讨论范围内，读者可以从样本的编码对数据分布的角度去思考。